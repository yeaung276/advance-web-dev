{% extends "includes/base.html" %}

{% load formatters %}

{% block title %}{{ title }} | Supernovae{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="fw-bold mb-1">{{ title }}</h1>
    <p class="text-muted mb-0">
      Top galaxies ranked by observational statistics
    </p>
  </div>

  <!-- API Link -->
  <a
    href="{% url api_url_name %}"
    class="btn btn-outline-secondary"
    target="_blank"
  >
    View API JSON
  </a>
</div>

<!-- Chart -->
<div class="card mb-5">
  <div class="card-body">
    <canvas id="galaxyChart" height="120"></canvas>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const labels = [
    {% for row in results %}
      "{{ row.galaxy__name }}"{% if not forloop.last %},{% endif %}
    {% endfor %}
  ];

  const dataValues = [
    {% for row in results %}
      {{ row|get_item:metric }}{% if not forloop.last %},{% endif %}
    {% endfor %}
  ];

  const ctx = document.getElementById("galaxyChart");

  new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{
        label: "{{ title }}",
        data: dataValues,
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            precision: 0
          }
        }
      }
    }
  });
</script>

{% endblock %}
